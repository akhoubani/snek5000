---
title: 'Snek5000: Python framework for Nek5000'
tags:
  - CFD
  - Python
  - Nek5000
  - FluidSim
  - Snakemake
authors:

    name: Ashwin Vishnu Mohanan
    orcid: 0000-0002-2979-6327
    equal-contrib: true
    affiliation: 1

    name: Arman Khoubani
    orcid: 0000-0002-0295-5308
    equal-contrib: true
    affiliation: 2

    name: Pierre Augier
    orcid: 0000-0001-9481-4459
    equal-contrib: true
    affiliation: 2

affiliations:

    name: Swedish Meteorological and Hydrological Institute, Norrk{\"o}ping, Sweden
    index: 1

    name: Laboratoire des \'Ecoulements G\'eophysiques et Industriels, Universit\'e~Grenoble~Alpes, 
      CNRS, Grenoble~INP, 38000~Grenoble, France
    index: 2

date: 2 March 2023
bibliography: paper.bib
---

# Summary

TODO: add a lot of citations, in particular of software papers...

Computational fluid dynamics (CFD) simulations are essential tools in various scientific
and engineering disciplines. Nek5000 is a CFD Fortran code based on spectral element
methods. It has a proven track record in numerous applications. In this article, we
present Snek5000, a Python package designed to streamline the management and
visualization of fluid dynamics simulations based on Nek5000. The package builds upon
the functionality of Nek5000 by providing a user-friendly interface for launching and
restarting simulations, loading simulation data, and generating figures and movies. This
paper introduces Snek5000, discusses its design principles, and highlights its impact on
the scientific community.

# Snek5000: features and capabilities

## A Fluidsim extension

Snek5000 is based on the CDF framework Fluidsim \[@fluidsim\], which introduces the concept of
"Fluidsim solvers". A Fluidsim solver \[@fluidsim\] is a set of files describing a set of potential
and similar simulations. A concrete simulation can be created via a simple and generic
Python API. For example,

```python
from snek5000_cbox import Simul

params = Simul.create_default_params()

# set simulation parameters
...

sim = Simul(params)
```

The last call created all the directories and files necessary to run the simulation. We
see that Fluidsim-Snek5000 can be seen as an advanced template system. One can now
launch the Nek5000 simulation with `sim.make.exec("run_fg")` . Since the simulations
generated by a solver share some similarities (for example some aspects of the geometry
and the equations), the solver can contain code to create, plot and postprocess output
data, which is accessible through objects contained in `sim.output` .

Snek5000 extends Fluidsim to enable users to create Fluidsim solvers for simulations
based on the Nek5000 code. Open-source solvers, such as [snek5000-phill](https://github.com/snek5000/snek5000-phill), [snek5000-cbox](https://github.com/snek5000/snek5000-cbox), 
and [snek5000-tgv](https://github.com/snek5000/snek5000/tree/main/docs/examples/snek5000-tgv), are available, and users can easily develop custom solvers tailored to
their specific Nek5000 cases. This flexibility allows researchers to adapt Snek5000 to a
wide range of fluid dynamics problems and simulation requirements.

## Streamlined simulation management

With a Snek5000-Fluidsim solver, users can efficiently launch and restart simulations
using Python scripts and a terminal command ( `snek-restart` ). Snek5000 handles various
all file operations, such as directory creation and file copying. This streamlines the
process of managing simulations, freeing up time and resources for data analysis and
understanding the underlying physics.

## Loading simulations and data visualization

It is very easy to "load" an existing simulation, i.e. to recreate a Python object `sim` similar to the one used to create the simulation. This can be done with the function
`snek5000.load` or with the command `snek-ipy-load` , which opens a IPython session with
a `sim` variable. Snek5000 simplifies the process of reading associated parameters (in
`sim.params` ) and data, and generating visualizations, such as figures ( `sim.output.phys_fields.plot_hexa` ) and movies ( `sim.output.phys_fields.animate` ). By
utilizing popular Python packages, such as Matplotlib [@matplotlib] and Xarray [@xarray], Snek5000 facilitates the creation of high-quality visualizations that can be easily customized to meet
individual needs. This powerful visualization capability aids researchers in
understanding complex fluid dynamics phenomena and effectively presenting their
findings.

## Post-processing and Data Analysis

Beyond visualization, Snek5000 also provides tools for post-processing and data
analysis. Users can easily load simulation data into Python for further processing,
statistical analysis, and comparison between different simulations. This streamlined
approach to data analysis enables researchers to gain valuable insights into their
simulations and focus on the underlying physical processes.

## Powered by Python Packages

Snek5000 leverages a variety of Python packages, including Snakemake \[@snakemake\], Fluidsim \[@fluidsim\], Pymech, Matplotlib \[@matplotlib\], Jinja, Pytest, and Xarray \[@xarray\], to deliver a robust and user-friendly workflow management tool for Nek5000. These packages provide a powerful foundation for Snek5000, enabling its seamless integration with existing Python-based workflows and enhancing its overall usability.

## Tutorials and Documentation

Snek5000 provides comprehensive [documentation](https://snek5000.readthedocs.io/) and
tutorials to guide users through its features and capabilities. These resources help new
users quickly become familiar with Snek5000 and enable experienced users to explore
advanced features and customization options. By providing thorough documentation,
Snek5000 promotes its widespread adoption and fosters a community of users and
developers.

## Future Developments and Enhancements

The Snek5000 development team is committed to continuously improving the package and
incorporating user feedback to address evolving needs within the scientific community.

Snek5000, has been thoughtfully designed with modularity and code reuse principles in mind. By leveraging inheritance and object-oriented programming, Snek5000 is well-positioned to accommodate the adoption of the next-generation NekRS \[@nekrs\] code, developed by the Nek5000 team, while maintaining its existing structure and functionality. This adaptability ensures that the framework stays up-to-date with the latest advancements in the field.

FluidsimFoam, currently under development, is a promising Fluidsim extension designed to bridge the gap between Fluidsim and OpenFOAM \[@openfoam\]. This extension allows users to create custom Fluidsim solvers specifically tailored for simulations on the widely-used open-source CFD software package, OpenFOAM. By harnessing the strengths of both tools, FluidsimFoam aims to provide a more versatile and user-friendly environment for conducting computational fluid dynamics simulations, broadening the scope of potential applications.

# Statement of need

Snek5000 is a powerful and versatile Python package designed to streamline the
management and visualization of Nek5000-based fluid dynamics simulations. By providing
an efficient interface for creating solvers, launching and restarting simulations, and
generating visualizations, Snek5000 enables researchers to focus on scientific discovery
and understanding complex fluid dynamics problems. With its open-source nature,
comprehensive documentation, and active development, Snek5000 has the potential to
significantly impact the fluid dynamics research community and drive further
advancements in the field.

# Acknowledgements

The authors acknowledge the numerical support provided by Olivier De-Marchi,
Gabriel Moreau and Cyrille Bonamy of the LEGI informatics team. This project
was funded by the project LEFE/IMAGO-2019 contract COSTRIO. AK acknowledges the
finance of his PhD thesis from the school STEP of the University Grenoble
Alpes. Part of this work was performed using resources provided by
\href{https://www.cines.fr/}{CINES} under GENCI allocation number A0120107567.

# References
